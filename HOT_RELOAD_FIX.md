# ุฅุตูุงุญ ูุดููุฉ ุชุฌูุน ุงูููุงุญุธุงุช ูู ูุฌูุฏ ูุงุญุฏ ุจุนุฏ Hot Reload

## ๐ ุงููุดููุฉ

ุนูุฏ ุนูู Hot Reloadุ ูุงูุช **ุฌููุน ุงูููุงุญุธุงุช** ูู ูุฌูุฏุงุช ูุตูุญุงุช ูุฎุชููุฉ ุชุธูุฑ ูู ูุฌูุฏ/ุตูุญุฉ ูุงุญุฏุฉ (`p1/f1`).

## ๐ ุงูุชุดุฎูุต

### ุงูุณุจุจ ุงูุฌุฐุฑู

ูุงูุช ุงููุดููุฉ ูู **ุชุฑุชูุจ ุงูุชููุฆุฉ** ู**ุงุณุชุฎุฏุงู ุงูููู ุงูุงูุชุฑุงุถูุฉ**:

#### 1. ุงูุชุฑุชูุจ ุงูุฎุงุทุฆ ููุชููุฆุฉ (ุงููุฏูู)
```dart
Future<void> _initialize() async {
  if (!_isInitialized) {
    _seed();                      // โ ููุดุฆ p1/f1 ุฃููุงู
    await _checkAndMigrateData(); 
    await _loadPages();           // ุชุญููู ุงูุตูุญุงุช ูุชุฃุฎุฑ
    await _loadSavedNotes();      
    _isInitialized = true;
  }
}
```

**ุงููุดููุฉ:**
- `_seed()` ูููุดุฆ ููุท ุตูุญุฉ ูุงุญุฏุฉ (`p1`) ููุฌูุฏ ูุงุญุฏ (`f1`)
- ุฅุฐุง ูุงู `_pages` ูุงุฑุบุงู ุฃุซูุงุก Hot Reloadุ ูุชู ุฅูุดุงุก `p1/f1` ููุท
- ุนูุฏูุง ุชูุญูู ุงูููุงุญุธุงุชุ ูุง ุชุฌุฏ ูุฌูุฏุงุชูุง ุงูุฃุตููุฉ

#### 2. ุงุณุชุฎุฏุงู ุงูููู ุงูุงูุชุฑุงุถูุฉ (ุงููุฏูู)
```dart
// โ ุงูููุฏ ุงููุฏูู
final pageId = noteData['pageId'] ?? 'p1';    // ุงูุชุฑุงุถู ุฎุทูุฑ!
final folderId = noteData['folderId'] ?? 'f1'; // ุงูุชุฑุงุถู ุฎุทูุฑ!
```

**ุงููุดููุฉ:**
- ุฅุฐุง ูุงูุช `pageId` ุฃู `folderId` ููููุฏุฉ ูู ุงูุจูุงูุงุชุ ูุชู ุงุณุชุฎุฏุงู `p1/f1`
- ูุฐุง ูุฌุนู **ุฌููุน** ุงูููุงุญุธุงุช ุงูุชู ุจุฏูู ูุนูููุงุช ูุฌูุฏ ุชุฐูุจ ุฅูู `p1/f1`

### ุงูุณููุงุฑูู ุงููุงูู ูููุดููุฉ

```
1. ุงููุณุชุฎุฏู ููุดุฆ:
   - ุตูุญุฉ "ุงูุนูู" (p2) ูุน ูุฌูุฏ "ูุดุงุฑูุน" (f2)
   - ุตูุญุฉ "ุงูุดุฎุตู" (p3) ูุน ูุฌูุฏ "ุฃููุงุฑ" (f3)
   - ููุงุญุธุงุช ูู ูู ูุฌูุฏ

2. ุนูุฏ Hot Reload:
   - ููุนุงุฏ ุชุดุบูู _initialize()
   - _seed() ูููุดุฆ ููุท p1/f1 (ุฅุฐุง ูุงู _pages ูุงุฑุบ)
   - _loadPages() ูุฏ ููุดู ุฃู ูุชุฃุฎุฑ
   - _loadSavedNotes() ูุจุฏุฃ ูุงูุตูุญุงุช ุบูุฑ ุฌุงูุฒุฉ
   
3. ุงููุชูุฌุฉ:
   - ุงูููุงุญุธุงุช ูู p2/f2 ู p3/f3 ุชุณุชุฎุฏู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
   - ุฌููุน ุงูููุงุญุธุงุช โ p1/f1 โ
```

## โ ุงูุญู

### 1. ุฅุตูุงุญ ุชุฑุชูุจ ุงูุชููุฆุฉ

```dart
Future<void> _initialize() async {
  if (!_isInitialized) {
    // 1๏ธโฃ ุชุญูู ูู ุงูุฅุตุฏุงุฑ ูุงูุชุฑุญูู ุฃููุงู
    await _checkAndMigrateData();
    
    // 2๏ธโฃ ุญููู ุจููุฉ ุงูุตูุญุงุช ูุงููุฌูุฏุงุช (ููู ุฌุฏุงู ูุจู ุงูููุงุญุธุงุช!)
    await _loadPages();
    
    // 3๏ธโฃ ุฅุฐุง ูู ุชูุฌุฏ ุตูุญุงุชุ ุฃูุดุฆ ุงูุงูุชุฑุงุถูุฉ
    if (_pages.isEmpty) {
      _seed();
    }
    
    // 4๏ธโฃ ุงูุขู ุญููู ุงูููุงุญุธุงุช (ุงูุตูุญุงุช ูุงููุฌูุฏุงุช ุฌุงูุฒุฉ)
    await _loadSavedNotes();
    
    _isInitialized = true;
  }
}
```

**ุงูููุงุฆุฏ:**
- โ ุชุญููู ุงูุตูุญุงุช **ูุจู** ุงูููุงุญุธุงุช
- โ `_seed()` ููุณุชุฏุนู ููุท ุฅุฐุง ูู ุชูุฌุฏ ุตูุญุงุช ูุญููุธุฉ
- โ ุงูููุงุญุธุงุช ุชุฌุฏ ูุฌูุฏุงุชูุง ุฏุงุฆูุงู

### 2. ุฅุฒุงูุฉ ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงูุฎุทูุฑุฉ

```dart
// โ ุงูููุฏ ุงูุฌุฏูุฏ
final pageId = noteData['pageId'];
final folderId = noteData['folderId'];

// ุฅุฐุง ูู ุชูู ููุฌูุฏุฉุ ุชุฎุทู ุงูููุงุญุธุฉ ูุน ุชุญุฐูุฑ
if (pageId == null || folderId == null) {
  debugPrint('โ๏ธ ุชุฎุทู ููุงุญุธุฉ ุจุฏูู pageId/folderId');
  continue;  // ุชุฎุทู ูุฐู ุงูููุงุญุธุฉ
}
```

**ุงูููุงุฆุฏ:**
- โ ูุง ุชูุฌุฏ ููู ุงูุชุฑุงุถูุฉ ุชุฎูู ุงููุดุงูู
- โ ุชุณุฌูู ูุงุถุญ ููููุงุญุธุงุช ุงููุดููุฉ
- โ ููุน ุชุฌูุน ุงูููุงุญุธุงุช ูู ูุฌูุฏ ูุงุญุฏ

### 3. ุชุญุณูู Factory Constructor

```dart
factory NotesRepository() {
  if (_instance == null) {
    _instance = NotesRepository._internal();
    // โ ุญููู ุงูุตูุญุงุช ุฃููุงู
    _instance!._loadPages().then((_) {
      if (_instance!._pages.isEmpty) {
        _instance!._seed();
      }
      _instance!._loadSavedNotes();
    });
  }
  return _instance!;
}
```

**ุงูููุงุฆุฏ:**
- โ ุญุชู ุนูุฏ ุงุณุชุฎุฏุงู Factoryุ ูุชู ุชุญููู ุงูุตูุญุงุช ุฃููุงู
- โ ุชููุฆุฉ ุขููุฉ

## ๐งช ุงุฎุชุจุงุฑ ุงูุญู

### ูุจู ุงูุฅุตูุงุญ โ
```
1. ุฅูุดุงุก ููุงุญุธุงุช ูู:
   - ุตูุญุฉ "ุงูุนูู" โ ูุฌูุฏ "ูุดุงุฑูุน"
   - ุตูุญุฉ "ุงูุดุฎุตู" โ ูุฌูุฏ "ุฃููุงุฑ"
   
2. Hot Reload
   
3. ุงููุชูุฌุฉ:
   ุฌููุน ุงูููุงุญุธุงุช ูู โ ุตูุญุฉ "ุงูุฑุฆูุณูุฉ" โ ูุฌูุฏ "ุนุงู" โ
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ
```
1. ุฅูุดุงุก ููุงุญุธุงุช ูู:
   - ุตูุญุฉ "ุงูุนูู" โ ูุฌูุฏ "ูุดุงุฑูุน"
   - ุตูุญุฉ "ุงูุดุฎุตู" โ ูุฌูุฏ "ุฃููุงุฑ"
   
2. Hot Reload
   
3. ุงููุชูุฌุฉ:
   ูู ููุงุญุธุฉ ูู ููุงููุง ุงูุตุญูุญ โ
```

## ๐ ุงูููุงุฑูุฉ

| ุงูุฌุงูุจ | ุงููุฏูู โ | ุงูุฌุฏูุฏ โ |
|--------|----------|----------|
| **ุชุฑุชูุจ ุงูุชููุฆุฉ** | seed โ loadPages โ loadNotes | loadPages โ seed โ loadNotes |
| **ุงูููู ุงูุงูุชุฑุงุถูุฉ** | `?? 'p1'` ู `?? 'f1'` | ูุญุต null + ุชุฎุทู |
| **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** | ุชุฌููุน ุตุงูุช | ุชุณุฌูู ูุงุถุญ |
| **Hot Reload** | ูููุฏ ุงูุจููุฉ | ูุญุงูุธ ุนูู ุงูุจููุฉ |

## ๐ฏ ุงูุชูุตูุงุช

### 1. ูููุทูุฑูู
```dart
// โ ุงุณุชุฎุฏู ุฏุงุฆูุงู
final repo = await NotesRepository.instance;

// โ ุชุฌูุจ (ููุงุณุชุฎุฏุงู ุงููุคูุช ููุท)
final repo = NotesRepository();
```

### 2. ุนูุฏ ุฅูุดุงุก ููุงุญุธุงุช ุฌุฏูุฏุฉ
```dart
// โ ุงุญูุธ ุฏุงุฆูุงู ูุน pageId ู folderId
await repo.saveNoteToFolder(content, pageId, folderId);

// โ ูุง ุชุณุชุฎุฏู (ูุฏูู)
await repo.saveNoteSimple(content);
```

### 3. ูุญุต ุงูุจูุงูุงุช
```dart
// ููุชุญูู ูู ุณูุงูุฉ ุงูุจูุงูุงุช
await repo.debugSavedNotes();
```

## ๐ง ุฃุฏูุงุช ุงูุชุดุฎูุต

### ูุญุต ุงูููุงุญุธุงุช ุงููุญููุธุฉ
```dart
Future<void> debugSavedNotes() async {
  final prefs = await SharedPreferences.getInstance();
  final notesJson = prefs.getStringList(_notesKey) ?? [];
  
  int withoutPageId = 0;
  int withoutFolderId = 0;
  
  for (int i = 0; i < notesJson.length; i++) {
    final noteData = jsonDecode(notesJson[i]);
    if (noteData['pageId'] == null) withoutPageId++;
    if (noteData['folderId'] == null) withoutFolderId++;
    
    print('[$i] Page: ${noteData['pageId']}, Folder: ${noteData['folderId']}');
  }
  
  print('๐ ููุงุญุธุงุช ุจุฏูู pageId: $withoutPageId');
  print('๐ ููุงุญุธุงุช ุจุฏูู folderId: $withoutFolderId');
}
```

## ๐จ ุนูุงูุงุช ุงูุชุญุฐูุฑ

### ุฅุฐุง ุฑุฃูุช ูู Console:
```
โ๏ธ ุชุฎุทู ููุงุญุธุฉ ุจุฏูู pageId/folderId
```

**ูุฐุง ูุนูู:**
- ุจุนุถ ุงูููุงุญุธุงุช ุงููุฏููุฉ ุจุฏูู ูุนูููุงุช ูุฌูุฏ
- ูุฌุจ ุฅุตูุงุญ ุงูุจูุงูุงุช ุฃู ุญุฐู ูุฐู ุงูููุงุญุธุงุช

### ุญู ุงูุจูุงูุงุช ุงููุฏููุฉ:
```dart
// ุฃุฏุงุฉ ูุฅุตูุงุญ ุงูููุงุญุธุงุช ุงููุฏููุฉ
Future<void> fixOldNotes() async {
  final prefs = await SharedPreferences.getInstance();
  final notesJson = prefs.getStringList(_notesKey) ?? [];
  final fixed = <String>[];
  
  for (final noteStr in notesJson) {
    final noteData = jsonDecode(noteStr);
    
    // ุฅุถุงูุฉ pageId ู folderId ุฅุฐุง ูุงูุช ููููุฏุฉ
    noteData['pageId'] ??= 'p1';
    noteData['folderId'] ??= 'f1';
    
    fixed.add(jsonEncode(noteData));
  }
  
  await prefs.setStringList(_notesKey, fixed);
  print('โ ุชู ุฅุตูุงุญ ${fixed.length} ููุงุญุธุฉ');
}
```

## โจ ุงูุฎูุงุตุฉ

**ุงููุดููุฉ:** ุชุฑุชูุจ ุฎุงุทุฆ ููุชููุฆุฉ + ููู ุงูุชุฑุงุถูุฉ ุฎุทูุฑุฉ  
**ุงูุญู:** ุชุญููู ุงูุตูุญุงุช ุฃููุงู + ุฅุฒุงูุฉ ุงูููู ุงูุงูุชุฑุงุถูุฉ  
**ุงููุชูุฌุฉ:** Hot Reload ุขูู + ุญูุธ ุตุญูุญ ููุจูุงูุงุช  

---

**ุงูุชุงุฑูุฎ**: 1 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ  
**ุงูุชุฃุซูุฑ**: Hot Reload ุงูุขู ุขูู 100%
